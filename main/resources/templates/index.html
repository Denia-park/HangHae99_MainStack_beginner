
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <title>ÏûêÏú†Í≤åÏãúÌåê</title>
    <meta property="og:title" content="ÏûêÏú†Í≤åÏãúÌåê" />
    <meta property="og:description" content="ÌïòÍ≥†Ïã∂ÏùÄ Îßê ÌïòÏÑ∏Ïöî" />
    <!--    <meta property="og:image" content="{{ url_for('static', filename='/img/mW_img.png') }}" />-->

    <style>
        .title_h1{
            color: indianred;

            display: flex;
            justify-content: center;
            align-items: center;

            margin-top: 100px;
            margin-bottom: 100px;
        }
        .title_h1 >h1{
            font-size: 50pt;
        }

        table, td, th {
            text-align: center;
            /*border-collapse : collapse;*/
            /*border : 1px solid black;*/
        }

        .boardTitle >b :hover{
            color: green;
            cursor: pointer;
        }

        .button_wrapper{
            display: flex;
            justify-content: right;
            align-items: center;

            margin: 15px;
        }

        .button_wrapper .login_button{
            margin-left: 15px;
        }
        .button_wrapper .write_button{
            margin-left: 15px;
        }

        /*ÌåùÏóÖÏ∞ΩÏùò Î≤ÑÌäºÏûÑ*/
        button {
            color: white;
            border-radius: 4px;
            /*border-radius: none;*/
        }
        /*===============================================================*/

        .popup-container_write {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .popup-container_write.active {
            display: flex;
        }

        .popup_write {
            padding: 20px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            width: 600px;
            height: 600px;
            border-radius: 11px;
            /*background-color: #ffffff;*/
            background-color: #CDB4B4;
        }

        .popup_write h1 {
            margin: 0px;
            font-size: 30px;
            font-weight: 500;
            font-stretch: normal;
            font-style: normal;
            line-height: 2;
            letter-spacing: -1.1px;
            color: #000000;
        }

        .popup_write input {
            width: 400px;
            height: 50px;
            border-radius: 2px;
            border: solid 1.1px #dee2e6;
            margin-right: 9px;
            margin-bottom: 10px;
            padding-left: 10px;
        }

        .popup_write input.input_writer {
            width: 160px;
            height: 50px;
            border-radius: 2px;
            border: solid 1.1px #dee2e6;
            margin-right: 9px;
            margin-bottom: 10px;
            padding-left: 10px;
        }

        .popup_write button.close_write {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #adb5bd;
            background-color: #fff;
            font-size: 19px;
            border: none;
        }

        .popup_write button.cta_write {
            width: 100px;
            height: 40px;
            border-radius: 2px;
            background-color: #15aabf;
            border: none;
        }

        /*===============================================================*/

        .popup-container_view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .popup-container_view.active {
            display: flex;
        }


        .popup_view {
            padding: 20px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            width: 600px;
            height: 600px;
            border-radius: 11px;
            /*background-color: #ffffff;*/
            background-color: #6F6E6E;
        }

        .popup_view h1 {
            margin: 0px;
            font-size: 30px;
            font-weight: 500;
            font-stretch: normal;
            font-style: normal;
            line-height: 2;
            letter-spacing: -1.1px;
            color: #000000;
        }

        .popup_view input {
            width: 330px;
            height: 39px;
            border-radius: 2px;
            border: solid 1.1px #dee2e6;
            margin-right: 9px;
            margin-bottom: 10px;
            padding-left: 10px;
        }

        .popup_view button.close_view {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #adb5bd;
            background-color: #fff;
            font-size: 19px;
            border: none;
        }

        .popup_view button.cta_view {
            width: 100px;
            height: 40px;
            border-radius: 2px;
            background-color: #15aabf;
            border: none;
        }
    </style>

    <script th:inline="javascript">
        /*<![CDATA[*/

        $(document).ready(function () {
            // id Í∞Ä query Ïù∏ ÎÖÄÏÑù ÏúÑÏóêÏÑú ÏóîÌÑ∞Î•º ÎàÑÎ•¥Î©¥ execSearch() Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÎùºÎäî ÎúªÏûÖÎãàÎã§.
            $('#close_write').on('click', function () {
                $('#container_write').removeClass('active');
            })

            getMessages();
            // showProduct();
        })

        function getMessages() {
            // 1. Í∏∞Ï°¥ ÎÇ¥Ïö©ÏùÑ ÏßÄÏõÅÎãàÎã§.
            // $('#cards-box').empty();
            // 2. Î©îÎ™® Î™©Î°ùÏùÑ Î∂àÎü¨ÏôÄÏÑú HTMLÎ°ú Î∂ôÏûÖÎãàÎã§.
            $.ajax({
                type: 'GET',
                url: '/api/freetables',
                success: function (response) {
                    console.log(response);
                    //ÌÉÄÏûÑÎ¶¨ÌîÑÎ•º Ïù¥Ïö©Ìï¥ÏÑú Í≤åÏãúÌåêÏùÑ Íæ∏Î©∞ÏïºÎê® !!.
                    // for (let i = 0; i < response.length; i++) {
                    //     let tableMsg = response[i];
                    //     let id = tableMsg['id'];
                    //     let title = tableMsg['title'];
                    //     let writer = tableMsg['writer'];
                    //     let createdAt = convertUTCTimeToSeoulTime(tableMsg['createdAt']);
                    //     addTableHTML(id, title ,writer, createdAt);
                    // }
                }
            })
        }

        function convertUTCTimeToSeoulTime(UTCDate){
            let SeoulTime = new Date(UTCDate)
            SeoulTime.setHours(SeoulTime.getHours()+9)
            // console.log(SeoulTime.toLocaleString())
            return SeoulTime.toLocaleString()
        }

        function addTableHTML(id,title ,username, createdAt) {
            // 1. HTML ÌÉúÍ∑∏Î•º ÎßåÎì≠ÎãàÎã§.
            let tempHtml = `
                            <tr>
                                <th scope="row">${id}</th>
                                <td colspan="3" onclick="enter_board_view(${id})">
                                    <b style="cursor: pointer;">
                                        ${title}
                                    </b>
                                </td>
                                <td>${username}</td>
                                <td>${createdAt}</td>
                            </tr>
                    `;
            // 2. #cards-box Ïóê HTMLÏùÑ Î∂ôÏù∏Îã§.
            $('#tableBody').append(tempHtml);
        }

        function enter_board_view(id) {
            $('#container_view_warp').empty();
            $.ajax({
                type: 'GET',
                url: `/api/freetables/${id}`,
                success: function (response) {
                        let tableMsg = response;
                        let title = tableMsg['title'];
                        let writer = tableMsg['writer'];
                        let content = tableMsg['content'];
                        let createdAt = convertUTCTimeToSeoulTime(tableMsg['createdAt']);
                    addTableViewHTML(title, writer, content,createdAt);

                    $('#container_view').addClass('active');

                    $('#close_view').on('click', function () {
                        $('#container_view').removeClass('active');
                    })
                }
            })
        }

        function addTableViewHTML(title, writer, content ,createdAt) {
            // 1. HTML ÌÉúÍ∑∏Î•º ÎßåÎì≠ÎãàÎã§.
            let tempHtml = `
                            <div id="container_view" class="popup-container_view">
                                <div class="popup_view">
                                    <button id="close_view" class="close_view">
                                            X
                                    </button>
                                    <h1>
                                        <b>
                                            üìúÍ≤åÏãúÍ∏Ä Ï°∞Ìöå ÌéòÏù¥ÏßÄ
                                        </b>
                                    </h1>
                                    <div>
                                        <b style="font-size: 13pt">ÏûëÏÑ±Ïùº</b>
                                        <p>${createdAt}</p>
                                    </div>
                                    <div>
                                        <b style="font-size: 17pt">Í∏Ä Ï†úÎ™©</b>
                                        <p>${title}</p>
                                    </div>
                                    <div>
                                        <b style="font-size: 17pt">ÏûëÏÑ±Ïûê</b>
                                        <p>${writer}</p>
                                    </div>
                                    <div>
                                        <b style="font-size: 17pt">ÎÇ¥Ïö©</b>
                                        <p>${content}</p>
                                    </div>
                                </div>
                            </div>
                    `;
            // 2. #container_view_warp Ïóê HTMLÏùÑ Î∂ôÏù∏Îã§.
            $('#container_view_warp').append(tempHtml);
        }

        function enter_board_write(){
            $('#container_write').addClass('active');
        }

        function postWriting() {
            let ftTitle = $('#mytitle').val();
            let ftUsername = [[${username}]];
            let ftContents = $('#mycontent').val();

            if (isValidContents(ftTitle) == false) {
                return;
            }
            if (isValidContents(ftUsername) == false) {
                return;
            }
            if (isValidContents(ftContents) == false) {
                return;
            }

            let data = {'title': ftTitle, 'username': ftUsername ,'content': ftContents};

            $.ajax({ // $.ajax = jQeury Î•º Ïù¥Ïö©ÌïòÍ≤†Îã§.
                type: "POST",
                url: "/api/freetables",
                contentType: "application/json", // JSON ÌòïÏãùÏúºÎ°ú Ï†ÑÎã¨Ìï®ÏùÑ ÏïåÎ¶¨Í∏∞
                data: JSON.stringify(data), //ÏõπÏóêÏÑú Ï£ºÍ≥† Î∞õÏùÑ Îïå Ïä§Ìä∏ÎßÅÏúºÎ°úÎßå Ï£ºÍ≥† Î∞õÍ∏∞ ÎïåÎ¨∏Ïóê Î¨∏ÏûêÏó¥Î°ú Î∞îÍøîÏÑú Ï†ÑÎã¨Ìï®
                success: function (response) {
                    alert('Î©îÏãúÏßÄÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏûëÏÑ±ÎêòÏóàÏäµÎãàÎã§.');
                    window.location.reload();
                }
            });
        }

        function isValidContents(contents) {
            if (contents == '') {
                alert('ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return false;
            }
            if (contents.trim().length > 15) {
                alert('Í≥µÎ∞± Ìè¨Ìï® 15Ïûê Ïù¥ÌïòÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return false;
            }
            return true;
        }

        const href = location.href;
        const queryString = href.substring(href.indexOf("?")+1)

        if (queryString === 'loginUserDoNotEnterErr') {
            alert("Ïù¥ÎØ∏ Î°úÍ∑∏Ïù∏Ïù¥ ÎêòÏñ¥ÏûàÏäµÎãàÎã§.");
            window.location.href = '/';
        }
        /*]]>*/
    </script>

</head>

<body style="background-color:black">

<div class="title_h1">
    <h1> <b>ÏûêÏú†Í≤åÏãúÌåê</b> </h1>
</div>

<div th:if="${userLoginCheck}" style="color: white; font-size: 20pt; text-align:right;">
    <span th:text="${username}"></span> Îãò ÏïàÎÖïÌïòÏÑ∏Ïöî.
</div>

<div class="button_wrapper">

    <div th:if="${userLoginCheck}" class="login_button">
        <button type="button"  onclick="location.href='/user/logout'" class="btn btn-secondary">Î°úÍ∑∏ÏïÑÏõÉ</button>
    </div>
    <div th:unless="${userLoginCheck}" class="write_button">
        <button type="button"  onclick="location.href='/user/signup'" class="btn btn-secondary">ÌöåÏõêÍ∞ÄÏûÖ</button>
        <button type="button"  onclick="location.href='/user/login'" class="btn btn-secondary" style="margin-left: 15px;">Î°úÍ∑∏Ïù∏</button>
    </div>

    <div th:if="${userLoginCheck}" class="write_button">
        <button type="button"  onclick="enter_board_write()" class="btn btn-secondary">Í∏Ä Ïì∞Í∏∞</button>
    </div>
</div>


<table class="table table-dark table-hover">
    <thead class="tablehead">
    <tr style="color: indianred">
        <th scope="col">Î≤àÌò∏</th>
        <th scope="col" colspan="3">Í∏Ä Ï†úÎ™©</th>
        <th scope="col">ÏûëÏÑ±Ïûê</th>
        <th scope="col">ÏûëÏÑ±Ïùº</th>
    </tr>
    </thead>
    <tbody id="tableBody">

    </tbody>
</table>

<div id="container_write" class="popup-container_write">
    <div class="popup_write">
        <button id="close_write" class="close_write">
            X
        </button>
        <h1>
            <b>
                ‚úèÍ∏Ä Ïì∞Í∏∞ ÌéòÏù¥ÏßÄ
            </b>
        </h1>
        <p>ÌïòÍ≥† Ïã∂ÏùÄ ÎßêÏùÑ ÏßßÍ≤å Ïç®Ï£ºÏÑ∏Ïöî.</p>
        <div>
            <p>
               <b>Í∏Ä Ï†úÎ™©</b>
            </p>
            <input type="text" id="mytitle" placeholder="">
        </div>
        <div>
            <p>
                <b>ÎÇ¥Ïö©</b>
            </p>
            <input type="text" id="mycontent" placeholder="">
        </div>
        <p>
        </p>
        <button class="cta_write" onclick="postWriting()">Í∏Ä Îì±Î°ùÌïòÍ∏∞</button>
    </div>
</div>

<div id="container_view_warp">


</div>

</body>
</html>


